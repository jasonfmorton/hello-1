name: test

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:

# Using config job to work around limitation in GitHub Actions
# where you can't use env or inputs to pass to multiple reusable jobs.
# Context: https://github.com/community/community/discussions/17554.
  config:
    runs-on: ubuntu-latest
    outputs:
      kms-key: ${{ steps.args.outputs.kms-key }}
      id-provider: ${{ steps.args.outputs.id-provider }}
      service-account: ${{ steps.args.outputs.service-account }}
      registry-uri: ${{ steps.args.outputs.registry-uri }}
      registry-name: ${{ steps.args.outputs.registry-name }}
    steps:
      - id: args
        run: |
          echo "text<<EOF" >> $GITHUB_OUTPUT
          echo "$(cat ci.config)" >> "$GITHUB_OUTPUT"
          echo "EOF" >> $GITHUB_OUTPUT
          

  print:
    runs-on: ubuntu-latest
    needs: config
    steps:
      - id: args
        run: |
          echo "kms-key: '${{ needs.config.outputs.kms-key }}'"
          echo "id-provider: '${{ needs.config.outputs.id-provider }}'"
          echo "service-account: '${{ needs.config.outputs.service-account }}'"
          echo "registry-uri: '${{ needs.config.outputs.registry-uri }}'"
          echo "registry-name: '${{ needs.config.outputs.registry-name }}'"